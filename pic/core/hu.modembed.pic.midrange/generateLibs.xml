<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     2013.01.09. 15:37:56                                                        

     Generate PicLibs   
     This build script generates PIC libraries based on the device descriptor XMLs
                   
     balazs.grill                                                                
     ====================================================================== -->
<project name="generateLibs" default="default">
	
	<include file="../../../res/build-tools/ant-contrib.xml"/>
	<include file="../../../res/build-tools/epsilon.xml"/>
	
    <description>
            This build script generates PIC libraries based on the device descriptor XMLs
    </description>
	
	<property name="picxml">PICs.xml</property>
	
    <!-- ================================= 
          target: default              
         ================================= -->
	
    <target name="default" description="description">
    	<echo>Generating PIC Libraries..</echo>
        <mkdir dir="gen-lib"/>
    	
    	<xslt basedir="../hu.modembed.pic/device-descriptors/16xxxx" destdir="gen-lib" 
    	    extension=".config.xmi" style="../hu.modembed.pic/device-descriptors/configgen.xsl">
    	</xslt>
    	
    	<fileset dir="../hu.modembed.pic/device-descriptors/16xxxx" id="devicefiles">
    	    <include name="*.PIC"/>
    	</fileset>
    	
    	<for param="file">
    		<fileset refid="devicefiles" />
    		<sequence>
    			<epsilon.egl
    				
    			/>
    			
    		</sequence>
    	</for>
    	
    	<pathconvert pathsep="&lt;/file&gt;${line.separator}&lt;file&gt;" property="devices" refid="devicefiles"/>
    	
    	<echo file="${picxml}">&lt;?xml version="1.0" encoding="UTF-8"?&gt;${line.separator}&lt;list&gt;${line.separator}</echo>
    	<echo file="${picxml}" append="true">&lt;file&gt;</echo>
    	<echo file="${picxml}" append="true">${devices}</echo>
    	<echo file="${picxml}" append="true">&lt;/file&gt;${line.separator}</echo>
       	<echo file="${picxml}" append="true">&lt;/list&gt;</echo>
    	
    	<xslt in="${picxml}" out="plugin.xml" style="generatePluginXML.xsl" />
    </target>
	
</project>
